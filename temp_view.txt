let
    GetShortages = (apiBase as text, apiKey as text) =>
        let
            url = Text.TrimEnd(apiBase, "/") & "/api/shortages",
            headers = [#"x-api-key" = apiKey, #"Accept" = "application/json"],
            raw = Web.Contents(url, [Headers = headers, Timeout = #duration(0,0,1,0)]),
            json = Json.Document(raw),
            list = if Type.Is(Value.Type(json), List.Type) then json else {},
            table = if List.Count(list) = 0 then #table({}, {}) else Table.FromRecords(list)
        in
            table
in
    GetShortages

