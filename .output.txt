 M frontend/src/App.jsx M frontend/src/AppContext.js M frontend/src/components/Header.jsx M nginx.conf?? _dev_db.sqlite.backup_20251205_124037?? last_response.json?? logs/nginx.pid
frontend/src/App.jsx
frontend/src/AppContext.js
frontend/src/components/Header.jsx
nginx.conf
diff --git a/frontend/src/App.jsx b/frontend/src/App.jsx
index ca89bb5..be53803 100644
--- a/frontend/src/App.jsx
+++ b/frontend/src/App.jsx
@@ -1,157 +1,19 @@
-import { Suspense, lazy, useEffect, useState, useCallback } from 'react';
-import { Routes, Route, Navigate, useLocation, useNavigate } from 'react-router-dom';
-import { useAppContext } from './AppContext';
-import Header from './components/Header';
-import MobileNav from './components/MobileNav';
-import Login from './components/Login';
-import ErrorBoundary from './components/ErrorBoundary';
-import { useAuth } from './auth/useAuth';
-import { useTheme } from './hooks/useTheme';
-import styles from './App.module.css';
-import CommandPalette from './components/CommandPalette';
-
-const LazyDashboard = lazy(() => import('./components/Dashboard'));
-const LazyOrders = lazy(() => import('./components/Orders'));
-const LazyProducts = lazy(() => import('./components/Products'));
-const LazyProduction = lazy(() => import('./components/Production'));
-const LazyInventory = lazy(() => import('./components/Inventory'));
-const LazyClients = lazy(() => import('./components/Clients'));
-const LazyTimesheets = lazy(() => import('./components/Timesheets'));
-const LazyReports = lazy(() => import('./components/Reports'));
-const LazyDemandPlanner = lazy(() => import('./components/DemandPlanner'));
-const LazyFinancials = lazy(() => import('./components/Financials'));
-const LazyUserGuide = lazy(() => import('./components/UserGuide'));
-const LazyAdmin = lazy(() => import('./components/Admin'));
-
-export default function App() {
-  const { lang, setLang, isSettingsOpen, setSettingsOpen } = useAppContext();
-  const { profile, checkingAuth, logout } = useAuth();
-  const { toggleTheme } = useTheme();
-  const location = useLocation();
-  const navigate = useNavigate();
-  const currentView = location.pathname.substring(1) || 'dashboard';
-  const [commandPaletteOpen, setCommandPaletteOpen] = useState(false);
-
-  // Keyboard shortcut for Command Palette (Cmd/Ctrl + K)
-  useEffect(() => {
-    const handleKeyDown = (e) => {
-      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
-        e.preventDefault();
-        setCommandPaletteOpen(prev => !prev);
-      }
-    };
-    window.addEventListener('keydown', handleKeyDown);
-    return () => window.removeEventListener('keydown', handleKeyDown);
-  }, []);
-
-  // Handle Command Palette actions
-  const handleCommandAction = useCallback((action) => {
-    switch (action) {
-      case 'toggleTheme':
-        toggleTheme();
-        break;
-      case 'langPL':
-        setLang('pl');
-        break;
-      case 'langEN':
-        setLang('en');
-        break;
-      case 'openSettings':
-        setSettingsOpen(true);
-        break;
-      case 'newOrder':
-        navigate('/orders');
-        // Could dispatch an event to open new order form
-        break;
-      case 'newProduct':
-        navigate('/products');
-        break;
-      case 'newClient':
-        navigate('/clients');
-        break;
-      default:
-        break;
-    }
-  }, [toggleTheme, setLang, setSettingsOpen, navigate]);
-
-  useEffect(() => {
-    localStorage.setItem('lang', lang);
-  }, [lang]);
-
-  const handleLogout = () => {
-    logout?.();
-    navigate('/dashboard');
-  };
-
-  const handleSettings = () => setSettingsOpen(true);
-
-  const handleViewChange = (newView) => {
-    if (newView !== currentView) {
-      navigate(`/${newView}`);
-    }
-  };
-
-  useEffect(() => {
-    const titles = {
-      dashboard: lang === 'pl' ? 'Panel główny' : 'Dashboard',
-      orders: lang === 'pl' ? 'Zamówienia' : 'Orders',
-      products: lang === 'pl' ? 'Produkty' : 'Products',
-      production: lang === 'pl' ? 'Produkcja' : 'Production',
-      planning: lang === 'pl' ? 'Planowanie' : 'Planning',
-      inventory: lang === 'pl' ? 'Magazyn' : 'Inventory',
-      clients: lang === 'pl' ? 'Klienci' : 'Clients',
-      timesheets: lang === 'pl' ? 'Czas pracy' : 'Timesheets',
-      reports: lang === 'pl' ? 'Raporty' : 'Reports',
-      demand: lang === 'pl' ? 'Popyt' : 'Demand planner',
-      financials: lang === 'pl' ? 'Finanse' : 'Financials',
-      help: lang === 'pl' ? 'Pomoc' : 'Help',
-      admin: lang === 'pl' ? 'Administracja' : 'Admin',
-    }
-    const viewTitle = titles[currentView] || 'Synterra'
-    document.title = `${viewTitle} - Synterra`;
-  }, [currentView, lang]);
-
-  if (checkingAuth) {
-    return (
-      <div className={styles.app}>
-        <main id="main-content" className={styles.mainContent}>
-          <div className={styles.container}><p>Loading...</p></div>
-        </main>
-      </div>
-    );
-  }
-
-  if (!profile) {
-    return <Login />;
-  }
-
-  return (
-    <ErrorBoundary>
-      <div className={styles.app}>
-        <Header
-          currentView={currentView}
-          setCurrentView={handleViewChange}
-          profile={profile}
-          onSettings={handleSettings}
-          onLogout={handleLogout}
-        />
         <main id="main-content" className={styles.mainContent}>
           <div className={styles.container}>
             <Suspense fallback={<p>Loading...</p>}>
               <Routes>
-                <Route path="/dashboard" element={<LazyDashboard setCurrentView={handleViewChange} />} />
-                <Route path="/orders" element={<LazyOrders jumpToFinance={(orderId) => navigate(`/financials?orderId=${orderId}`)} />} />
-                <Route path="/products" element={<LazyProducts />} />
-                <Route path="/production" element={<LazyProduction />} />
-                <Route path="/inventory" element={<LazyInventory />} />
-                <Route path="/clients" element={<LazyClients />} />
-                <Route path="/timesheets" element={<LazyTimesheets />} />
-                <Route path="/reports" element={<LazyReports />} />
-                <Route path="/demand" element={<LazyDemandPlanner />} />
-                <Route path="/financials" element={<LazyFinancials />} />
-                <Route path="/help" element={<LazyUserGuide />} />
-                <Route path="/admin" element={profile?.is_admin ? <LazyAdmin /> : <Navigate to="/dashboard" replace />} />
-                <Route path="*" element={<Navigate to="/dashboard" replace />} />
+                <Route path="/dashboard" element={<LazyDashboard lang={lang} setCurrentView={handleViewChange} />} />
+                <Route path="/orders" element={<LazyOrders lang={lang} jumpToFinance={(orderId) => navigate(`/financials?orderId=${orderId}`)} />} />
+                <Route path="/products" element={<LazyProducts lang={lang} />} />
+                <Route path="/production" element={<LazyProduction lang={lang} />} />
+                <Route path="/inventory" element={<LazyInventory lang={lang} />} />
+                <Route path="/clients" element={<LazyClients lang={lang} />} />
+                <Route path="/timesheets" element={<LazyTimesheets lang={lang} />} />
+                <Route path="/reports" element={<LazyReports lang={lang} />} />
+                <Route path="/demand" element={<LazyDemandPlanner lang={lang} />} />
+                <Route path="/financials" element={<LazyFinancials lang={lang} />} />
+                <Route path="/help" element={<LazyUserGuide lang={lang} />} />
+                <Route path="/admin" element={profile?.is_admin ? <LazyAdmin lang={lang} /> : <Navigate to="/dashboard" replace />} />
               </Routes>
             </Suspense>
           </div>
diff --git a/frontend/src/AppContext.js b/frontend/src/AppContext.js
index 6c42eb3..0c2f619 100644
--- a/frontend/src/AppContext.js
+++ b/frontend/src/AppContext.js
@@ -10,7 +10,8 @@ export function AppProvider({ children }) {
   const [lang, setLangState] = useState(() => {
     try {
       const stored = localStorage.getItem('lang');
-      return stored === 'en' ? 'pl' : (stored || 'pl');
+      // Allow only supported languages; default to 'pl'
+      return stored === 'en' || stored === 'pl' ? stored : 'pl';
     } catch {
       return 'pl';
     }
@@ -19,12 +20,13 @@ export function AppProvider({ children }) {

   const setLang = (newLang) => {
     try {
-      // Wymuszamy tylko 'pl' jako dozwolony język
-      localStorage.setItem('lang', newLang === 'en' ? 'pl' : newLang);
+      // Persist only supported languages; fallback to 'pl'
+      const next = newLang === 'en' || newLang === 'pl' ? newLang : 'pl';
+      localStorage.setItem('lang', next);
     } catch (e) {
       console.warn('Failed to save language to localStorage', e);
     }
-    setLangState(newLang === 'en' ? 'pl' : newLang);
+    setLangState(newLang === 'en' || newLang === 'pl' ? newLang : 'pl');
   };

   const value = {
diff --git a/frontend/src/components/Header.jsx b/frontend/src/components/Header.jsx
index 6d72cfd..5b47e06 100644
--- a/frontend/src/components/Header.jsx
+++ b/frontend/src/components/Header.jsx
@@ -68,13 +68,7 @@ export default function Header({

   const navItems = laptopNav

-  useEffect(() => {
-    try {
-      localStorage.setItem('lang', lang)
-    } catch (err) {
-      console.warn('Persisting lang failed', err)
-    }
-  }, [lang])
+  // Language persistence is centrally handled in AppContext

   // Close dropdowns on outside click with proper focus management
   useEffect(() => {
diff --git a/nginx.conf b/nginx.conf
index 73d5bae..b5a2d49 100644
--- a/nginx.conf
+++ b/nginx.conf
@@ -78,8 +78,8 @@ http {
         # SPA fallback; avoid redirect loops if index missing
         location / {
             try_files $uri $uri/ /index.html =404;
-            expires 1h;
-            add_header Cache-Control "public, no-transform";
+            expires 0;
+            add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
         }

         # Backend API proxy
@@ -137,8 +137,8 @@ http {
         # Frontend static files
         location / {
             try_files $uri $uri/ /index.html =404;
-            expires 1h;
-            add_header Cache-Control "public, no-transform";
+            expires 0;
+            add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
         }

         # Backend API proxy
main
805989a (HEAD -> main, origin/main, origin/HEAD) Refactored App.jsx for improved state management, navigation, and UX/UI
5.1.26100.7019